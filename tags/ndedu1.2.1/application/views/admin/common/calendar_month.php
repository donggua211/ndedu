<div id="nav">	<div id="nav_left">		<span class="action-span"><a href="<?php echo site_url('admin') ?>"  target="_top">管理系统</a></span>		<span class="action-span"> » <a href="<?php echo site_url('admin/calendar') ?>" target="main-frame">日程管理</a></span>		 » <?php echo $year.'年'.$month.'月' ?>	</div>	<?php if(is_admin() || is_school_admin()): //权限: 只有管理员可以按状态?>	<div id="nav_right">		<select onchange="window.location.href=this.options[this.selectedIndex].value">			<option value='<?php site_url("admin/calendar/day/$year/$month/$day/") ?>'>选择员工</option>			<?php				foreach($staffs as $staff)					echo '<option value="'.site_url("admin/calendar/month/$year/$month/".$staff['staff_id']).'" '.(($staff['staff_id'] == $staff_id)? 'SELECTED' : '').'>'.$staff['name'].'</option>';			?>		</select>	</div>	<?php endif?></div><div style="clear:both"></div><div id="main">	<div id="main_body">		<div class="calendar">			<div class="month-nav">				<a href="<?php echo calendar_url('admin/calendar/month/'.($year - 1).'/'.$month, $staff_id, $is_owner) ?>">上一年</a>				<a href="<?php echo calendar_url('admin/calendar/month/'.$prev_year.'/'.$prev_month, $staff_id, $is_owner) ?>">上一月</a>				<?php				for($i = 1; $i <= 12; $i++) {					if($i < $month)						$attribs = 'class="past"';					elseif($i == $month)						$attribs = 'class="present"';					else						$attribs = 'class="future"';					echo "<a href=\"".calendar_url('admin/calendar/month/'.$year.'/'.$i, $staff_id, $is_owner)."\" $attribs>$i 月</a>";				}				?>					<a href="<?php echo calendar_url('admin/calendar/month/'.$next_year.'/'.$next_month, $staff_id, $is_owner) ?>">下一月</a>				<a href="<?php echo calendar_url('admin/calendar/month/'.($year + 1).'/'.$month, $staff_id, $is_owner) ?>">下一年</a>			</div>			<table class="main calendar">				<caption><?php echo $year.'年'.$month.'月' ?></caption>				<colgroup span="7" width="14%"><col width="3%"></colgroup>				<thead>					<tr>						<th>周</th>						<th>周一</th>						<th>周二</th>						<th>周三</th>						<th>周四</th>						<th>周五</th>						<th>周六</th>						<th>周日</th>					</tr>				</thead>				<tbody>					<?php 					for($week_of_month = 1; $week_of_month <= $wim; $week_of_month++) 					{						$start_day = 1 + ($week_of_month - 1) * 7 - day_of_week($month, 1, $year);						$week_of_year = week_of_year($month, $start_day, $year);						echo "<tr><th>$week_of_year</th>";											for($day_of_week = 0; $day_of_week < 7; $day_of_week++)						{							$this_year = $year;							$this_month = $month;							$this_day = $start_day + $day_of_week;							if($this_day <= 0)							{								$this_month--;								if($this_month < 1)								{									$this_month = 12;									$this_year--;								}								$this_day += days_in_month($this_month, $this_year);								$current_era = 'none';							}							elseif($this_day > days_in_month($this_month, $this_year))							{								$this_day -= days_in_month($this_month, $this_year);								$this_month++;								if($this_month > 12)								{									$this_month = 1;									$this_year++;								}								$current_era = 'none';							}							else							{								$currentday = date('j');								$currentmonth = date('n');								$currentyear = date('Y');								// set whether the date is in the past or future/present								if($currentyear == $this_year && $currentmonth == $this_month && $currentday == $this_day)								{									$current_era = 'present';								}								elseif($currentyear > $this_year || $currentyear == $this_year										&& ($currentmonth > $this_month || $currentmonth == $this_month && $currentday > $this_day))								{									$current_era = 'past';								}								else								{									$current_era = 'future';								}							}														echo '<td valign="top" class="'.$current_era.'">									<div class="date">';							if($is_owner)								echo '	<a href="'.calendar_url('admin/calendar/add/'.$this_year.'/'.$this_month.'/'.$this_day, $staff_id, TRUE).'" class="add">+</a>';							echo '		<a href="'.calendar_url('admin/calendar/day/'.$this_year.'/'.$this_month.'/'.$this_day, $staff_id, $is_owner).'">'.$this_day.'</a>									</div>';														$stamp = mktime(0, 0, 0, $this_month, $this_day, $this_year);							$key = date('Y-m-d', $stamp);							if(array_key_exists($key, $days_calendar) && !empty($days_calendar[$key]))							{								echo '<ul>';								// Count the number of events								$count = 0;								foreach($days_calendar[$key] as $event)								{									echo '<li>';									if($count == 8)									{										echo '<a href="'.calendar_url('admin/calendar/day/'.$this_year.'/'.$this_month.'/'.$this_day, $staff_id, $is_owner).'" style="date">查看更多日程</a>';										break;									}									$count++;									// TODO - make sure we have permission to read the event									$start_ts = strtotime($event['start_time']);									$end_ts = strtotime($event['end_time']);																		//显示									$calendar_content = utf_substr((date('h:i', $start_ts).'--'.$event['calendar_content']), 27);																		$calendar_title = date('m月d日H:i', $start_ts).'--'.date('m月d日H:i', $end_ts).'. 内容: '.$event['calendar_content'];																		echo '<a href="'.calendar_url('admin/calendar/day/'.$this_year.'/'.$this_month.'/'.$this_day, $staff_id, $is_owner).'"  title="'.$calendar_title.'">'.$calendar_content.'</a></li>';								}								echo '</ul>';							}							echo '</td>';						}						echo "</tr>";					}					?>				</tbody>			</table>		</div>	</div></div>